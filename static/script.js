""===existingCookie&&$.get("https://docs.google.com/spreadsheets/d/e/2PACX-1vQ4j7DTedeNo74Fv_9X5GtFgn1fciZPllG5F--y1jErWhs5ncO5tHrRafXyiBzpg9R9Z-HzsHlA69UF/pubhtml",function(e){let t=$("<div></div>").html(e),o=t.find("table"),n=o.find("tr"),a=[];n.each((e,t)=>{let o=$(t).find("td");if(o.length>0){let n=o.eq(0).text(),l=o.eq(1).text(),i=o.eq(2).text();a.push(`${n}: ${l} Points [<a target="_blank" href="${i}">Verification</a>]`)}});let l=new Date;l.setTime(l.getTime()+3e5),document.cookie=`rowData=${JSON.stringify(a)}; expires=${l.toUTCString()}; path=/`,a.forEach(e=>{let t=$("<li></li>").html(e);$("#leaderboard").append(t)}),$("#leaderboard-container").show()}).fail(function(e){console.error("Error fetching Google Sheet:",e)});let game=function(){let e,t,o,n=[],a,l,i,r,s,d={0:{given:["points","route","time","distance"],chances:2,time:35},1:{given:["points","route","time"],chances:1,time:30},2:{given:["points","time"],chances:1,time:20},3:{given:["time"],chances:1,time:15}},c={0:"World",1:"America",2:"Europe",3:"Asia",4:"Africa",5:"Oceania"},u={0:"easy",1:"medium",2:"hard",3:"insane"},g=1,m=0,_=0,h=!1,p=!1,f=!0,b,v=$("#time"),y=$("#mile"),C=$("#checkmark"),w=$("#distCont"),L=$("#chance"),R=$("#state"),k=$("#pluralC"),x=$("#total_availablePoints"),T=$("#percentPoints"),S=$("#timeS"),j=$("#round"),D=$(".toast"),M=$("#totalPoints"),Z=$("#retryMatch"),P=$("#compRoundRouteTime"),E=$("#compRoundRouteDist"),N=$("#userRoundRouteTime"),G=$("#userRoundRouteDist"),A=$("#curPoints"),F=$("#roundBox"),O=$("#endGame"),q=$("#imgCard"),H=$(".card")[0];mapboxgl.accessToken="pk.eyJ1IjoiZGhlaXJ5YXQiLCJhIjoiY2xqcG5ubDkyMDBwZTNucGZuNGxmaTV0ZiJ9.-dBvk8f1ip-dcIxNlprUrA";let I=new easytimer.Timer,J=new mapboxgl.Map({logoPosition:"bottom-right",container:"map",style:"mapbox://styles/mapbox/navigation-day-v1",center:[7.5,20],zoom:1.45,minZoom:1.45}),V=new mapboxgl.Map({container:"background",style:"mapbox://styles/mapbox/satellite-v9",projection:"globe",center:[-40,30],zoom:-.00161764705*$(document).height()+5.276470581,interactive:!1});function z(){if(f){let e=V.getZoom(),t=18;e>3&&(t*=(5-e)/2);let o=V.getCenter();o.lng-=t,V.easeTo({center:o,duration:1e3,easing:e=>e})}}function B(){$("#start button").prop("disabled",!0),$(".slideLogo").addClass("small").attr("onclick","location.reload()"),$("#start").fadeOut(400,function(){$("#mode").fadeIn(400)})}function U(){$("#mode button").prop("disabled",!0),$("#mode").fadeOut(400,function(){$("#countries").fadeIn(400)})}function X(){$("#countries button").prop("disabled",!0),Y($("#mode .mainContainer div").index($("#mode .mainContainer").find(".active")),$("#countries .mainContainer div").index($("#countries .mainContainer").find(".active"))),$("#preGame").fadeOut(400,function(){f=!1,$("#gameContainer").fadeIn(400),J.resize(),D.html("Loading first round..."),D.addClass("on")})}function W(){setTimeout(()=>{D.removeClass("on")},2e3)}function Y(c,u){J.setMinZoom(1.45),h=!1,p=!1,t&&e&&s||(t=c,e=u,s=d[t]),s.given.includes("distance")||w.hide(),s.chances>1?k.show():k.hide(),L.html(s.chances),S.html(s.time),$.getJSON({url:`/random/?places=${e}&difficulty=${t}`,headers:{AK:"3d5a1025-10e1-48ec-877b-22da4b377196"},success(e){$.getJSON(`https://router.project-osrm.org/route/v1/driving/${e.lon1},${e.lat1};${e.lon2},${e.lat2}?overview=full&geometries=geojson`,t=>{if("NoRoute"===t.code)D.html("Whoops! Something bad happened on our end... Please reload site to continue!"),D.addClass("on");else{Q(!1),D.removeClass("on");let{geometry:d,duration:u,distance:g}=t.routes[0],m=Math.round(g/1e3);if(o=d,s.given.includes("points"))var _,h,f=new mapboxgl.Marker({color:"#888"}).setLngLat([e.lon1,e.lat1]).addTo(J),b=new MapboxCircle({lat:e.lat1,lng:e.lon1},100*m*(c+1),{editable:!1,minRadius:5e3,fillColor:"#888"}).addTo(J),L=new mapboxgl.Marker({color:"#888"}).setLngLat([e.lon2,e.lat2]).addTo(J),R=new MapboxCircle({lat:e.lat2,lng:e.lon2},100*m*(c+1),{editable:!1,minRadius:5e3,fillColor:"#888"}).addTo(J);i=[e.lon1,e.lat1],r=[e.lon2,e.lat2],s.given.includes("route")&&J.addLayer({id:"compRoute",type:"line",source:{type:"geojson",data:{type:"Feature",properties:{},geometry:d}},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#888","line-width":6,"line-opacity":2/3}});let k=new mapboxgl.LngLatBounds,x=new mapboxgl.LngLat(J.getCenter().lng,J.getCenter().lat),T=new mapboxgl.LngLat((e.lon1+e.lon2)/2,(e.lat1+e.lat2)/2);k.extend([e.lon1,e.lat1]),k.extend([e.lon2,e.lat2]);let S;(_=k,h=x.distanceTo(T),S=$.Deferred(),D.html("Flying to generated route..."),D.addClass("on"),J.once("moveend",function(){setTimeout(function(){S.resolve()},20)}),J.fitBounds(_,{padding:50,duration:3e-4*h}),S).then(function(){I.start({countdown:!0,startValues:{seconds:s.time}}),J.setMinZoom(4.75),Q(!0),D.html("Start!"),W()});let j=new mapboxgl.Marker({draggable:!0}).setLngLat([(e.lon1+e.lon2)/2+.01,(e.lat1+e.lat2)/2+.01]).addTo(J),M=new mapboxgl.Marker({draggable:!0}).setLngLat([(e.lon1+e.lon2)/2-.01,(e.lat1+e.lat2)/2-.01]).addTo(J);s.given.includes("points")?n.push(f,L,b,R,j,M):n.push(j,M),a=[(e.lon1+e.lon2)/2+.01,(e.lat1+e.lat2)/2+.01],l=[(e.lon1+e.lon2)/2-.01,(e.lat1+e.lat2)/2-.01];let Z=[(e.lon1+e.lon2)/2+.01,(e.lat1+e.lat2)/2+.01];j.on("dragend",function(e){let t=e.target.getLngLat();if(a=[t.lng,t.lat],s.given.includes("points")){let o=[b.getCenter().lng,b.getCenter().lat],n=[R.getCenter().lng,R.getCenter().lat],l=b.getRadius()/1e5,i=Math.sqrt(Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)),r=Math.sqrt(Math.pow(a[0]-n[0],2)+Math.pow(a[1]-n[1],2));i<l||r<l?(e.target.setLngLat(Z),D.html("Can't drag marker into exclusion circle..."),D.addClass("on"),W()):(Z=[t.lng,t.lat],p=!0)}else p=!0});let P=[(e.lon1+e.lon2)/2-.01,(e.lat1+e.lat2)/2-.01];M.on("dragend",function(e){let t=e.target.getLngLat();if(l=[t.lng,t.lat],s.given.includes("points")){let o=[b.getCenter().lng,b.getCenter().lat],n=[R.getCenter().lng,R.getCenter().lat],a=R.getRadius()/1e5,i=Math.sqrt(Math.pow(l[0]-o[0],2)+Math.pow(l[1]-o[1],2)),r=Math.sqrt(Math.pow(l[0]-n[0],2)+Math.pow(l[1]-n[1],2));i<a||r<a?(e.target.setLngLat(P),D.html("Can't drag marker into exclusion circle..."),D.addClass("on"),W()):(P=[t.lng,t.lat],p=!0)}else p=!0});let E=Math.floor(u/3600),N=Math.floor(u%3600/60);E>0?0!==N?v.html(E+" Hours and "+N+" Minutes"):v.html(E+" Hours"):v.html(N+" Minutes"),s.given.includes("distance")&&w.show(),y.html(Math.round(m/1.609344)+" Miles"),C.removeClass("disabled"),I.addEventListener("targetAchieved",function(){D.html("Times over! Checking round..."),D.addClass("on"),j.setDraggable(!1),M.setDraggable(!1),I.stop(),K(!0)})}})}})}function K(e){if(!h){h=!0,I.stop(),e||(D.html("Checking round..."),D.addClass("on")),C.addClass("disabled");let t=$.getJSON(`https://router.project-osrm.org/nearest/v1/driving/${a[0]},${a[1]}`),d=$.getJSON(`https://router.project-osrm.org/nearest/v1/driving/${l[0]},${l[1]}`);Promise.all([t,d]).then(([e,t])=>{let o=[e.waypoints[0].location[0],e.waypoints[0].location[1]],n=[t.waypoints[0].location[0],t.waypoints[0].location[1]];return $.getJSON(`https://router.project-osrm.org/route/v1/driving/${o[0]},${o[1]};${n[0]},${n[1]}?overview=full&geometries=geojson`)}).then(e=>{if(C.removeClass("disabled"),"NoRoute"===e.code)D.html("No possible route... Pick another point!"),D.addClass("on"),I.start({countdown:!0,startValues:{seconds:S.html()}}),h=!1;else{I.removeEventListener("targetAchieved"),D.removeClass("on"),s.given.includes("points")?(n[4].setDraggable(!1),n[5].setDraggable(!1)):(n[0].setDraggable(!1),n[1].setDraggable(!1)),J.getLayer("userRoute")&&J.removeLayer("userRoute"),J.getSource("userRoute")&&J.removeSource("userRoute");let{geometry:t,duration:a,distance:l}=e.routes[0];J.addLayer({id:"userRoute",type:"line",source:{type:"geojson",data:{type:"Feature",properties:{},geometry:t}},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3fb1ce","line-width":6,"line-opacity":2/3}});let d=v.html();P.html(d),E.html(y.html().replace(/\D/g,""));let c=Math.floor(a/3600),u=Math.floor(a%3600/60);if(c>0?0!==u?N.html(c+" Hours and "+u+" Minutes"):N.html(c+" Hours"):N.html(u+" Minutes"),G.html(Math.round(l/1e3/1.609344)),j.html(g),s.given.includes("route")||J.addLayer({id:"compRoute",type:"line",source:{type:"geojson",data:{type:"Feature",properties:{},geometry:o}},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#888","line-width":6,"line-opacity":2/3}}),!s.given.includes("points")){let p=new mapboxgl.Marker({color:"#888"}).setLngLat(i).addTo(J),f=new MapboxCircle({lat:i[0],lng:i[1]},.1*y.html().replace(/\D/g,""),{editable:!1,minRadius:5e3,fillColor:"#888"}).addTo(J),b=new mapboxgl.Marker({color:"#888"}).setLngLat(r).addTo(J),w=new MapboxCircle({lat:r[0],lng:r[1]},.1*y.html().replace(/\D/g,""),{editable:!1,minRadius:5e3,fillColor:"#888"}).addTo(J);n.push(p,b,f,w)}2===parseInt(L.html())?(Z.show(),L.html("1"),k.hide()):(L.html("0"),Z.hide());let O=function e(t){let o=t.replace("and ","").split(" "),n=0,a=0;for(let l=0;l<o.length;l++)isNaN(o[l])||("Hours"===o[l+1]&&(n=o[l]),"Minutes"!==o[l+1]||(a=o[l]));return 3600*n+60*a}(d),q=Math.abs(O-a);m+=_=q>=O?0:10*Math.ceil(5e3*(1-q/O)/10),A.html(_),M.html(m),x.html(5e3*g),T.html(Math.round(m/(5e3*g)*100)),F.show(),R.removeClass("fa-check").addClass("fa-angles-right"),C.attr("onclick","game.nextRound()"),J.setMinZoom(1.45),g++}}).catch(e=>{console.log(e),C.removeClass("disabled"),D.html("No possible route... Pick another point!"),D.addClass("on"),I.start({countdown:!0,startValues:{seconds:S.html()}}),h=!1})}}function Q(e){e?(J.boxZoom.enable(),J.scrollZoom.enable(),J.dragPan.enable(),J.keyboard.enable(),J.doubleClickZoom.enable()):(J.boxZoom.disable(),J.scrollZoom.disable(),J.dragPan.disable(),J.keyboard.disable(),J.doubleClickZoom.disable())}function ee(){if(g>10){O.show();let o=new URL(window.location.protocol + "//" + window.location.hostname + ":" + window.location.port + "/image/");o.searchParams.append("points",m),o.searchParams.append("country",e),o.searchParams.append("difficulty",t),$.ajax({url:o.toString(),headers:{AK:"3d5a1025-10e1-48ec-877b-22da4b377196"},method:"GET",xhrFields:{responseType:"blob"},success(e){let t=window.URL||window.webkitURL,o=t.createObjectURL(e);q.attr("src",o)}}),C.addClass("disabled"),Q(!1)}else C.addClass("disabled"),F.hide(),v.html("Loading..."),y.html("Loading..."),I.reset(),I.stop(),J.getLayer("compRoute")&&J.removeLayer("compRoute"),J.getSource("compRoute")&&J.removeSource("compRoute"),J.getLayer("userRoute")&&J.removeLayer("userRoute"),J.getSource("userRoute")&&J.removeSource("userRoute"),n.length&&(n.forEach(e=>e.remove()),n=[]),R.removeClass("fa-angles-right").addClass("fa-check"),C.attr("onclick","game.checkRound(false)"),Y(t,e),D.html("Loading next round..."),D.addClass("on")}function et(e){let t=e.clientX,o=e.clientY,n=t-b.x,a=o-b.y,l={x:n-b.width/2,y:a-b.height/2},i=Math.sqrt(l.x**2+l.y**2);H.style.transform=`scale3d(1.07, 1.07, 1.07) rotate3d(${l.y/100}, ${-l.x/100}, 0, ${2*Math.log(i)}deg)`,H.querySelector(".glow").style.backgroundImage=`radial-gradient(circle at ${2*l.x+b.width/2}px ${2*l.y+b.height/2}px, #ffffff55, #0000000f)`}return J.on("load",()=>{J.dragRotate.disable(),J.touchZoomRotate.disableRotation(),J.addControl(new mapboxgl.ScaleControl({unit:"imperial"}),"bottom-right"),J.addControl(new mapboxgl.NavigationControl({showCompass:!1}),"bottom-right")}),V.on("load",()=>{V.on("moveend",()=>{f&&z()}),z()}),document.body.onkeyup=function(e){(" "===e.key||"Space"===e.code||32===e.keyCode)&&(C.hasClass("disabled")?$("#preGame").is(":visible")&&($("#start").is(":visible")?B():$("#mode").is(":visible")?U():$("#countries").is(":visible")&&X()):h?ee():p?K(!1):(D.html("Have to move a point before checking!"),D.addClass("on"),W()))},H.addEventListener("mouseenter",()=>{b=H.getBoundingClientRect(),document.addEventListener("mousemove",et)}),H.addEventListener("mouseleave",()=>{document.removeEventListener("mousemove",et),H.style.transform="",H.style.background=""}),I.addEventListener("secondsUpdated",function(){I.getTimeValues().seconds>9?S.html(I.getTimeValues().seconds):S.html("0"+I.getTimeValues().seconds)}),{shareSocialRumbles:function o(){window.open("https://socialrumbles.com/post/s/new/?text=In DaWaze, I just got a score of "+m+" on "+u[t]+" in "+c[e]+"mode, beat me!&url=https%3A%2F%2Fdawaze.me","_blank")},download:function e(t){let o=document.createElement("a");o.href=t,o.download="dawaze.png",document.body.appendChild(o),o.click(),document.body.removeChild(o)},checkRound:K,retryRound:function e(){m-=_,S.html(s.time),R.removeClass("fa-angles-right").addClass("fa-check"),C.attr("onclick","game.checkRound(false)"),F.hide(),J.getLayer("userRoute")&&J.removeLayer("userRoute"),J.getSource("userRoute")&&J.removeSource("userRoute"),n[4].setDraggable(!0),n[5].setDraggable(!0),n[4].setLngLat([(i[0]+r[0])/2+.01,(i[1]+r[1])/2+.01]),n[5].setLngLat([(i[0]+r[0])/2-.01,(i[1]+r[1])/2-.01]),g--,I.reset(),I.start({countdown:!0,startValues:{seconds:s.time}}),h=!1},nextRound:ee,slide1:B,slide2:U,startGame:X}}();